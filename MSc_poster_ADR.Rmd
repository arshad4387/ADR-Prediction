---
title: Prediction of ADRs using NMF and Weighted NMFs
author:
  - name: Arshad Ahamed Shajahan
  - name: Sai Shasank Dandu
    affil: 
affiliation:
  - num: 1
    address: School of Mathematical and Statistical Sciences, University of Galway
logoleft_name: https&#58;//sport.universityofgalway.ie/assets/img/logo2.png

poster_height: "594mm"
poster_width: "841mm"
column_numbers: 4
column_margins: "0.5in"	
primary_colour:	"#a80050"	# Secondary colour use for poster design.
secondary_colour:	"#84003d"	# Main colour used for poster design.
accent_colour:	"#e6007e"	# A third colour option.
author_textcol: "white"
title_textsize: "80pt"
author_textsize: "55pt"
body_textsize: "25pt"
output: 
  posterdown::posterdown_html:
    self_contained: true
    pandoc_args: --mathjax
    number_sections: false
knit: pagedown::chrome_print
---

```{css, echo=FALSE}
div.logo_left{
  width: 20%;
}
div.poster_title{
  width: 80%;
}
.section h4 {
    break-after: column;
}
div.footnotes {
    font-size: 18pt;
}
```

<!-- Don't change anything above, except the title and author names, unless you know what you are doing. -->

```{r, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE,
                      tidy = FALSE,
                      message = FALSE,
                      fig.align = 'center',
                      out.width = "100%")
options(knitr.table.format = "html") 

# Load any additional libraries here
library(tidyverse)
library(plotly)
library(kableExtra)
library(dplyr)
library(ggplot2)
library(pheatmap)
library(patchwork)

```

# Background and Objectives

<!-- You can add references by inserting the following ^[reference details here] -->

Adverse drug reactions (ADRs) are a common problem in clinical and pharmacovigilance research and can lead to serious patient harm and biased conclusions if modelled poorly. Sparse, noisy, and highly imbalanced drug ADR data often cause standard machine learning methods to perform no better than naïve frequency‑based approaches, unless appropriate low‑rank and kernel‑based methods are used with clear assumptions [1].

## Objectives

1.  Explain the ADR profile prediction problem and its statistical challenges in imbalanced, noisy health data.
2.  Explore low‑rank and kernel‑based methods (e.g. NMF+kernel regression and alternatives) for ADR prediction.

# Datasets

The primary source of datasets are DGIdb 4.0, SIDER 4.1 and PubChem database.

1.  Drug-gene interaction pair: Intersection of drugs from DGIdb 4.0 and SIDER 4.1, generated to the binary matrix form.
2.  Chemical fingerprints: Data from PubChem database, generated to the binary matrix form.
3.  Drug & side effects: Drug along with it's side effects are extracted from SIDER 4.1 database.

# Descriptive Statistics

```{r, include=FALSE}
#Load the files
dgi <- read.csv("Drug_gene_interaction.csv", row.names = 1)
drug_se <- read.csv("Drug_side_effects.csv")
drug_cf <- read.csv("Chemical_fingerprint.csv", row.names = 1)
```


```{r, include=TRUE}

top_drugs <- drug_se %>% count(drugbank_name) %>% top_n(35, n) %>% pull(drugbank_name)
top_effects <- drug_se %>% count(side_effect_name) %>% top_n(35, n) %>% pull(side_effect_name)

matrix_data <- drug_se %>%
  filter(drugbank_name %in% top_drugs, side_effect_name %in% top_effects) %>%
  select(drugbank_name, side_effect_name) %>%
  distinct() %>%
  mutate(present = 1) %>%
  pivot_wider(names_from = side_effect_name, 
              values_from = present, 
              values_fill = 0) %>%
  column_to_rownames("drugbank_name")

# Plot Heatmap with Dendrograms
pheatmap(as.matrix(matrix_data), 
         clustering_distance_rows = "binary", 
         clustering_distance_cols = "binary",
         main = "Clustering Drugs by Side Effect Profiles",
         color = c("white", "firebrick"),
         fontsize_row = 7, fontsize_col = 7,
         legend_breaks = c(0, 1), legend_labels = c("No ADR", "ADR Present"))
```


```{r}
# Distribution of side effects and drugs
drug_burden <- drug_se %>%
  count(drugbank_name, sort = TRUE)

ggplot(drug_burden, aes(x = n)) +
  geom_histogram(binwidth = 5, fill = "orange", color = "white") +
  labs(title = "Distribution of Side Effects for Drugs", 
       x = "Number of Side Effects", y = "Number of Drugs") +
  theme_minimal()
```

The above graph mentions the drugs majority of the drugs have more than 200 side effects, emphasising the importance of this study.

```{r}

# Top 15 drugs with most side effects
top_drugs <- drug_se %>%
  count(drugbank_name, sort = TRUE) %>%
  slice_head(n = 15)

plot_drugs <- ggplot(top_drugs, aes(x = reorder(drugbank_name, n), y = n)) +
  geom_col(fill = "#440154FF") +  # dark purple
  coord_flip() +
  labs(
    title = "Top Drugs with Highest Side Effects",
    subtitle = "Drugs associated with the greatest number of unique ADRs",
    x = "Drug Name", 
    y = "Number of Side Effects"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    plot.title = element_text(face = "bold", size = 14),
    plot.subtitle = element_text(size = 10)
  )

# Top 15 most frequent side effects
top_side_effects <- drug_se %>%
  count(side_effect_name, sort = TRUE) %>%
  slice_head(n = 15)

plot_side_effects <- ggplot(top_side_effects, aes(x = reorder(side_effect_name, n), y = n)) +
  geom_col(fill = "#31688EFF") +  # steel blue
  coord_flip() +
  labs(
    title = "Top Most Frequent Side Effects",
    subtitle = "Most pervasive clinical symptoms across dataset",
    x = "Side Effect", 
    y = "Frequency (Number of Drugs)"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    plot.title = element_text(face = "bold", size = 14),
    plot.subtitle = element_text(size = 10)
  )

# Combining the plots side by side
combined_plot <- plot_drugs + plot_side_effects + 
  plot_layout(ncol = 2) +
  plot_annotation(
    title = "ADR Dataset Overview",
    subtitle = "Comparison of Top Drugs and Side Effects",
    theme = theme(plot.title = element_text(face = "bold", size = 16))
  )
combined_plot
```

From the dataset, these are the drugs which possess the most side effects displayed alongside the most common side effects.

```{r}

# Prepare Side Effect counts as an annotation dataframe
se_counts <- drug_se %>%
  count(drugbank_name) %>%
  rename("ADR Count" = n) %>%
  as.data.frame()

# Set drug names as row names for the annotation data
rownames(se_counts) <- se_counts$drugbank_name

# Align the datasets
common_drugs <- intersect(rownames(drug_cf), rownames(se_counts))
subset_drugs <- common_drugs[1:35]

# Create the annotation table for the rows
row_ann <- se_counts[subset_drugs, "ADR Count", drop = FALSE]

# Create the data matrix
plot_matrix <- as.matrix(drug_cf[subset_drugs, 1:35])

# Plot
pheatmap(plot_matrix,
         annotation_row = row_ann,
         clustering_distance_rows = "binary",
         cluster_cols = FALSE,
         color = c("white", "black"),
         main = " Drug vs Chemical Structure vs Adverse Drug Reactions",
         annotation_colors = list("ADR Count" = colorRampPalette(c("yellow", "red"))(50)),
         fontsize_row = 6, fontsize_col = 6)
```
```{r, include=FALSE}
drug_burden <- drug_se %>%
  count(drugbank_name, sort = TRUE)

# 2.2 Distribution of side effect counts
ggplot(drug_burden, aes(x = n)) +
  geom_histogram(binwidth = 5, fill = "orange", color = "white") +
  labs(title = "Distribution of Side Effects per Drug", 
       x = "Number of Side Effects", y = "Number of Drugs") +
  theme_minimal()

# 2.3 Top 10 drugs with most side effects
head(drug_burden, 10)
```

[^2]: Murphy et al. 2005 doi: 10.1186/1468-6708-6-11

<!-- This #### below causes the columns to break -->

<!-- You can change where you put these breaks, and the "column_numbers: 4" argument in the YAMLS header to change the layout of the poster, with care! -->
 

# Methods 
1.We implemented five ADR profile prediction methods using DGI features only:
Naïve frequency model (ADR prevalence per column), kernel regression (KR), linear SVM, RBF‑kernel SVM, and VKR (NMF + kernel ridge regression).


```{r mytable, out.width='80%'}
```


```{r standard-plot, out.width='80%', fig.align='center', fig.cap='Early Performance of ADR Prediction Methods', fig.height=4}

```

```{css, echo=FALSE}
div.logo_left{
  width: 20%;
}
div.poster_title{
  width: 80%;
}
div.footnotes {
    font-size: 18pt;
}
.images-row {
  display: flex;
  justify-content: space-around;
  flex-wrap: wrap;
  margin: 0.5em 0;
}

.images-row img {
  max-width: 100%;
  margin: 2.5em;
  border: none;
  box-shadow: none;
}



```

# Early Results

Preliminary analysis on the DGI dataset shows that the Naïve baseline and VKR achieve the highest AUROC (≈0.91), while KR and VKR achieve the best AUPR (≈0.41–0.42), clearly outperforming SVM variants on both metrics. VKR therefore provides the best overall trade‑off between discrimination (AUROC) and rare ADR detection (AUPR), motivating its use as the main reference method in further experiments.

```{r images-row, echo=FALSE, results='asis', fig.align='center', out.width='100%'}
cat('<div class="images-row">')
knitr::include_graphics(
  c(
    "Supporting Documents/output.png"
  )
)
cat('</div>')

```
####

# Future Work

We plan to conduct further analysis using:

-   Extended Data set with latest drug available from SIDER 4.1 & DGIdb database [^3]
-   New methods using weighted NMF, SVD and weighted SVD [^4].

[^3]: https://doi.org/10.1093/nar/gkv1075

[^4]: https://doi.org/10.3390/rs13020268

We will use the `PYTHON` Programming for this.


# GitHub

The code and datasets for this project can be viewed at our GitHub repository here: <https://github.com/arshad4387/ADR-Prediction.git>



# Acknowldgement
We would like to thank Dr.Yezhao Zhong, Cathal Seoighe , Dr.Haixuan Yang for their work in ADR prediction and sharing the code and data through the github page.
 

# References
[1] Zhong, Y., Seoighe, C., & Yang, H. (2024). Non-Negative matrix factorization combined with kernel regression for the prediction of adverse drug reaction profiles. Bioinformatics Advances, 4(1), vbae009.

