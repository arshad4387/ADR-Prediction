---
title: Prediction of Adverse Drug Reactions Using Advanced Statistical Methods
author:
  - name: Arshad Ahamed Shajahan
  - name: Sai Shasank Dandu <br> Supervised by Dr. Davood Roshan
affiliation:
    address: School of Mathematical and Statistical Sciences, University of Galway
logoleft_name: https&#58;//sport.universityofgalway.ie/assets/img/logo2.png

poster_height: "594mm"
poster_width: "841mm"
column_numbers: 4
column_margins: "0.35in"	
primary_colour:	"#a80050"	# Secondary colour use for poster design.
secondary_colour:	"#84003d"	# Main colour used for poster design.
accent_colour:	"#e6007e"	# A third colour option.
author_textcol: "white"
title_textsize: "55pt"
author_textsize: "40pt"
body_textsize: "25pt"
output: 
  posterdown::posterdown_html:
    self_contained: true
    pandoc_args: --mathjax
    number_sections: false
knit: pagedown::chrome_print
---

```{css, echo=FALSE}
div.logo_left{
  width: 20%;
}
div.poster_title{
  width: 80%;
}
.section h4 {
    break-after: column;
}
div.footnotes {
    font-size: 16pt;
}
.section h1, 
.section h2, 
.section h3, 
.section h4 {
  margin-top: 0em !important;
}
.figure {
  margin-bottom: 0.2em !important;
}
#methods {
  margin-top: 0em !important;
}
.figure p.caption {
  margin-top: 0.1em !important;
  margin-bottom: 0.2em !important;
  line-height: 1.1 !important;
}
.figure {
  margin-bottom: 0.3em !important;
}


```

```{r, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE,
                      tidy = FALSE,
                      message = FALSE,
                      fig.align = 'center',
                      out.width = "100%")
options(knitr.table.format = "html") 

# Load any additional libraries here
library(tidyverse)
library(plotly)
library(kableExtra)
library(dplyr)
library(ggplot2)
library(pheatmap)
library(patchwork)

```

# Background

Adverse drug reactions (ADRs) are a common problem in clinical and pharmacovigilance research and can lead to serious patient harm and biased conclusions if modelled poorly. Sparse, noisy, and highly imbalanced drug ADR data often cause standard machine learning methods to perform no better than naïve frequency‑based approaches, unless appropriate low‑rank and kernel‑based methods are used with clear assumptions [1].

# Aim and Objectives  

To predict adverse drug reaction (ADR) profiles by integrating chemical fingerprints and drug–gene interaction using advanced statistical modeling approaches.

The primary objectives are to, <br>
1.  Explain the ADR profile prediction problem and its statistical challenges in imbalanced, noisy health data.<br>
2.  Explore various statistical methods for ADR prediction.

# Datasets

1.  **Drug-gene interaction pair**: Intersection of drugs from **DGIdb 4.0** and **SIDER 4.1**, generated to the binary matrix form with drugs on rows and genes on columns. (Dim:778X2022)
2.  **Chemical fingerprints**: Data from **PubChem** database, generated to the binary matrix form with drugs on rows and chemical fingerprints on columns. (Dim:778X1024)
3.  **Drug & side effects**: Drug along with it's side effects are extracted from **SIDER 4.1** database. (Dim:1020x5) 

# Descriptive Statistics

```{r, include=FALSE}
#Load the files
dgi <- read.csv("Drug_gene_interaction.csv", row.names = 1)
drug_se <- read.csv("Drug_side_effects.csv")
drug_cf <- read.csv("Chemical_fingerprint.csv", row.names = 1)
```

**Figure 1** displays the distribution of side effects per drugs. This histogram illustrates a right-skewed distribution, where the majority of drugs have a relatively low number of side effects, typically clustered between 0 and 200. As the number of side effects increases, the frequency of drugs drops significantly, with few extreme outliers reaching over 800 side effects.
```{r fig-adr-distribution, out.width='80%', fig.align='center', fig.cap=' Distribution of side effects per drug', fig.height=4}
# Load libraries
library(ggplot2)
library(dplyr)

# Ensure data exists
if(!exists("drug_burden")){
  drug_burden <- drug_se %>%
    count(drugbank_name, sort = TRUE)
}

# Plot
ggplot(drug_burden, aes(x = n)) +
  geom_histogram(binwidth = 5, fill = "orange", color = "white") +
  labs(x = "Number of Side Effects", y = "Number of Drugs") +
  theme_minimal()
```
**Figure 2** highlights a statistical concentration where a small group of medications exhibits over 800 unique adverse drug reactions (ADRs). Simultaneously, the data identifies pervasive clinical symptoms, such as nausea and headache, which are shared by nearly 900 different drugs.
```{r combined-plot, out.width='80%', fig.align='center', fig.cap='Drugs with most side effects and most frequent side effects', fig.height=6}

# Top 15 drugs with most side effects
top_drugs <- drug_se %>%
  count(drugbank_name, sort = TRUE) %>%
  slice_head(n = 15)

plot_drugs <- ggplot(top_drugs, aes(x = reorder(drugbank_name, n), y = n)) +
  geom_col(fill = "#440154FF") +  # dark purple
  coord_flip() +
  labs(
    title = "Drugs with Max Side Effects",
    subtitle = "Drugs associated with the greatest number of unique ADRs",
    x = "Drug Name", 
    y = "Number of Side Effects"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    plot.title = element_text(face = "bold", size = 14),
    plot.subtitle = element_text(size = 10)
  )

# Top 15 most frequent side effects
top_side_effects <- drug_se %>%
  count(side_effect_name, sort = TRUE) %>%
  slice_head(n = 15)

plot_side_effects <- ggplot(top_side_effects, aes(x = reorder(side_effect_name, n), y = n)) +
  geom_col(fill = "#31688EFF") +  # steel blue
  coord_flip() +
  labs(
    title = "Most Frequent Side Effects",
    subtitle = "Most pervasive clinical symptoms across dataset",
    x = "Side Effect", 
    y = "Frequency (Number of Drugs)"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    plot.title = element_text(face = "bold", size = 14),
    plot.subtitle = element_text(size = 10)
  )

# Combining the plots side by side
combined_plot <- plot_drugs + plot_side_effects + 
  plot_layout(ncol = 2) +
  plot_annotation(
    theme = theme(plot.title = element_text(face = "bold", size = 16))
  )
combined_plot
```
**Figure 3** presents a heatmap illustrating statistically significant clustering where specific drug pairs share more than 80% of their side-effect profiles, indicating high pharmacological redundancy. 
```{r Heatmap-plot, out.width='80%', fig.align='center', fig.cap='Drug and side effects similarity', fig.height=5}
# Heatmap plot
binary_df <- drug_se %>%
  select(drugbank_name, side_effect_name) %>%
  distinct() %>%
  mutate(present = 1) %>%
  pivot_wider(names_from = side_effect_name, values_from = present, values_fill = 0)

# Convert to Matrix
mat <- as.matrix(binary_df[,-1])
rownames(mat) <- binary_df$drugbank_name

# Calculate Intersection and Union for all 1020 drugs
intersection_matrix <- mat %*% t(mat)
side_effect_counts <- diag(intersection_matrix)
sum_matrix <- outer(side_effect_counts, side_effect_counts, "+")
union_matrix <- sum_matrix - intersection_matrix

# Calculate % Similarity (Jaccard Index)
similarity_matrix <- (intersection_matrix / union_matrix) * 100
similarity_matrix[is.na(similarity_matrix)] <- 0

# Set the threshold
threshold <- 80
keep_drugs <- rownames(similarity_matrix)[apply(similarity_matrix, 1, function(x) any(x >= threshold & x < 100))]

# Subset the matrix to only these drugs
focused_matrix <- similarity_matrix[keep_drugs, keep_drugs]

# We define 100 color breaks from 0 to 100 to fix the scale
colors <- colorRampPalette(c("#ffffff", "#deebf7", "#9ecae1", "#3182bd", "#08519c"))(100)
breaks_list <- seq(0, 100, length.out = 101)

pheatmap(focused_matrix,
         # Clustering
         cluster_rows = TRUE,
         cluster_cols = TRUE,
         treeheight_row = 30,
         treeheight_col = 30,
         
         show_rownames = TRUE,      
         show_colnames = TRUE,      
         fontsize_row = 6,          
         fontsize_col = 6,          
         cellwidth = 7,             
         cellheight = 7,
         angle_col = 45,            
         
         color = colors,
         breaks = breaks_list,      
         main = paste("Clustered Drug Similarity (Threshold >=", threshold, "%)"),
         border_color = NA,         
         legend_breaks = c(0, 25, 50, 75, 100),
         legend_labels = c("0%", "25%", "50%", "75%", "100% Shared"))


```



```{r, include=FALSE}

# Prepare Side Effect counts as an annotation dataframe
se_counts <- drug_se %>%
  count(drugbank_name) %>%
  rename("ADR Count" = n) %>%
  as.data.frame()

# Set drug names as row names for the annotation data
rownames(se_counts) <- se_counts$drugbank_name

# Align the datasets
common_drugs <- intersect(rownames(drug_cf), rownames(se_counts))
subset_drugs <- common_drugs[1:35]

# Create the annotation table for the rows
row_ann <- se_counts[subset_drugs, "ADR Count", drop = FALSE]

# Create the data matrix
plot_matrix <- as.matrix(drug_cf[subset_drugs, 1:35])

# Plot
pheatmap(plot_matrix,
         annotation_row = row_ann,
         clustering_distance_rows = "binary",
         cluster_cols = FALSE,
         color = c("white", "black"),
         main = " Drug vs Chemical Structure vs Adverse Drug Reactions",
         annotation_colors = list("ADR Count" = colorRampPalette(c("yellow", "red"))(50)),
         fontsize_row = 6, fontsize_col = 6)
```
```{r, include=FALSE}
drug_burden <- drug_se %>%
  count(drugbank_name, sort = TRUE)

# 2.2 Distribution of side effect counts
ggplot(drug_burden, aes(x = n)) +
  geom_histogram(binwidth = 5, fill = "orange", color = "white") +
  labs(title = "Distribution of Side Effects per Drug", 
       x = "Number of Side Effects", y = "Number of Drugs") +
  theme_minimal()

# 2.3 Top 10 drugs with most side effects
head(drug_burden, 10)
```

# Methods 
ADR Profile Prediction Methods Using Drug–Gene Interaction Chemical fingerprint Features:  
**1. Naïve Frequency Model**: Predicts ADRs based solely on their observed prevalence in the dataset, serving as a baseline.  
**2. Kernel Regression (KR)**: Models the relationship between drug features and ADRs using a similarity-based kernel approach.  
**3. Linear SVM**: Classifies ADR presence using a linear hyperplane in feature space.  
**4. RBF-Kernel SVM**: Employs a non-linear radial basis function kernel to capture complex relationships between drug features and ADRs.  
**5. VKR (NMF + Kernel Ridge Regression)**: Combines low-rank latent factor decomposition (NMF) with kernel ridge regression to predict ADRs in sparse and imbalanced datasets.
```{r standard-plot, out.width='80%', fig.align='center', fig.cap='Early Performance of ADR Prediction Methods', fig.height=4}

```
```{css, echo=FALSE}
div.logo_left{
  width: 20%;
}
div.poster_title{
  width: 80%;
}
div.footnotes {
    font-size: 18pt;
}
.images-row {
  display: flex;
  justify-content: space-around;
  flex-wrap: wrap;
  margin: 0.5em 0;
}

.images-row img {
  max-width: 100%;
  margin: 0.1em;
  border: none;
  box-shadow: none;
}



```
# Early Results

Preliminary analysis on the **figure 4** shows that the **Naïve baseline and VKR achieve the highest AUROC (≈0.91)**, while **KR and VKR achieve the best AUPR (≈0.41–0.42)**, clearly outperforming SVM variants on both metrics. VKR therefore provides the best overall trade‑off between discrimination (AUROC) and rare ADR detection (AUPR), motivating its use as the main reference method in further experiments.
```{r images-row, echo=FALSE, results='asis', out.width='80%', fig.align='center', fig.cap='Early Performance of ADR Prediction Methods', fig.height=4} 
cat('<div class="images-row">')
knitr::include_graphics(
  c(
    "Supporting Documents/output.png"
  )
)
cat('</div>')

```
# Future Work

-   Extended Data set with latest drug available from SIDER 4.1 & DGIdb database [2]
-   New methods using weighted NMF, SVD and weighted SVD need to be explored. [3]

# Acknowldgement
We would like to thank Dr. Yezhao Zhong, Dr. Cathal Seoighe , Dr. Haixuan Yang for their work in ADR prediction and sharing the code and data through the github page.  

# References
[1] Yezhao Zhong, Cathal Seoighe, Haixuan Yang, Non-Negative matrix factorization combined with kernel regression for the prediction of adverse drug reaction profiles, Bioinformatics Advances, Volume 4, Issue 1, 2024, vbae009.<br>
[2] Kuhn M, Letunic I, Jensen LJ, Bork P. The SIDER database of drugs and side effects. Nucleic Acids Res. 2016 Jan 4;44(D1):D1075-9. <br>
[3] Y. -D. Kim and S. Choi, "Weighted nonnegative matrix factorization," 2009 IEEE International Conference on Acoustics, Speech and Signal Processing, Taipei, Taiwan, 2009, pp. 1541-1544.  
<br> 
The code and datasets for this project can be viewed at our GitHub repository here: <https://github.com/arshad4387/ADR-Prediction.git>