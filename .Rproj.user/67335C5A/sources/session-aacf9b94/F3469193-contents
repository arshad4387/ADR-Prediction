---
title: Prediction of ADRs using NMF and Weighted NMFs
author:
  - name: Arshad Ahamed Shajahan
  - name: Sai Shasank Dandu
    affil: 1
affiliation:
  - num: 1
    address: School of Mathematical and Statistical Sciences, University of Galway
logoleft_name: https&#58;//sport.universityofgalway.ie/assets/img/logo2.png

poster_height: "594mm"
poster_width: "841mm"
column_numbers: 4
column_margins: "0.5in"	
primary_colour:	"#a80050"	# Secondary colour use for poster design.
secondary_colour:	"#84003d"	# Main colour used for poster design.
accent_colour:	"#e6007e"	# A third colour option.
author_textcol: "white"
title_textsize: "90pt"
author_textsize: "60pt"
body_textsize: "25pt"
output: 
  posterdown::posterdown_html:
    self_contained: true
    pandoc_args: --mathjax
    number_sections: false
knit: pagedown::chrome_print
---

```{css, echo=FALSE}
div.logo_left{
  width: 20%;
}
div.poster_title{
  width: 80%;
}
.section h4 {
    break-after: column;
}
div.footnotes {
    font-size: 18pt;
}
```

<!-- Don't change anything above, except the title and author names, unless you know what you are doing. -->

```{r, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE,
                      tidy = FALSE,
                      message = FALSE,
                      fig.align = 'center',
                      out.width = "100%")
options(knitr.table.format = "html") 
# Load any additional libraries here
library(tidyverse)
library(plotly)
library(kableExtra)
library(dplyr)
library(ggplot2)
library(pheatmap)
```

# Background and Objectives

<!-- You can add references by inserting the following ^[reference details here] -->

Adverse drug reactions (ADRs) are a common problem in clinical and pharmacovigilance research and can lead to serious patient harm and biased conclusions if modelled poorly. Sparse, noisy, and highly imbalanced drug ADR data often cause standard machine learning methods to perform no better than naïve frequency‑based approaches, unless appropriate low‑rank and kernel‑based methods are used with clear assumptions.
[^1]: https://doi.org/10.1093/bioadv/vbae009

## Objectives

1.  Explain the ADR profile prediction problem and its statistical challenges in imbalanced, noisy health data.
2.  Explore low‑rank and kernel‑based methods (e.g. NMF+kernel regression and alternatives) for ADR prediction.
3.  Apply these methods to updated drug–ADR datasets with additional molecular and interaction features.

# Data Sources and Datasets

The primary source of data are DGIdb 4.0, SIDER 4.1 and PubChem database.

1.  Drug-gene interaction pair: Intersection of drugs from DGIdb 4.0 and SIDER 4.1, generated to the binary matrix form.
2.  Chemical fingerprints: Data from PubChem database, generated to the binary matrix form.
3.  Drug & side effects: Drug along with it's side effects are extracted from SIDER 4.1 database.

```{r, include=FALSE}
#Load the files
dgi <- read.csv("Drug_gene_interaction.csv", row.names = 1)
drug_se <- read.csv("Drug_side_effects.csv")
drug_cf <- read.csv("Chemical_fingerprint.csv")

top_side_effects <- drug_se %>%
  count(side_effect_name, sort = TRUE) %>%
  head(25)

ggplot(top_side_effects, aes(x = reorder(side_effect_name, n), y = n)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  coord_flip() +
  labs(title = "Top 25 Most Common Side Effects", x = "Side Effect", y = "Frequency") +
  theme_minimal()
```


```{r, include=FALSE}

# To make the heatmap readable, we take the Top 50 drugs and Top 50 side effects
top_drugs <- drug_se %>% count(drugbank_name) %>% top_n(35, n) %>% pull(drugbank_name)
top_effects <- drug_se %>% count(side_effect_name) %>% top_n(35, n) %>% pull(side_effect_name)

# Create a binary matrix (1 if side effect exists, 0 otherwise)
matrix_data <- drug_se %>%
  filter(drugbank_name %in% top_drugs, side_effect_name %in% top_effects) %>%
  # SELECT ONLY NECESSARY COLUMNS FIRST
  select(drugbank_name, side_effect_name) %>%
  # Ensure no duplicates (1 row per drug-effect pair)
  distinct() %>%
  mutate(present = 1) %>%
  # Now pivot will correctly collapse into one row per drug
  pivot_wider(names_from = side_effect_name, 
              values_from = present, 
              values_fill = 0) %>%
  column_to_rownames("drugbank_name")

# Plot Heatmap with Dendrograms
pheatmap(as.matrix(matrix_data), 
         clustering_distance_rows = "binary", 
         clustering_distance_cols = "binary",
         main = "Clustering Drugs by Side Effect Profiles",
         color = c("white", "firebrick"),
         fontsize_row = 7, fontsize_col = 7,
         legend_breaks = c(0, 1), legend_labels = c("No ADR", "ADR Present"))
```


```{r}
# --- Plot 1: Top 20 Drugs by Side Effect Count ---
top_20_drugs <- drug_se %>%
  count(drugbank_name, sort = TRUE) %>%
  slice_head(n = 15)

ggplot(top_20_drugs, aes(x = reorder(drugbank_name, n), y = n)) +
  geom_col(fill = "#440154FF") + # Dark purple
  coord_flip() +
  labs(title = "Top 20 Drugs with Highest Side Effect Burden",
       subtitle = "Drugs associated with the greatest number of unique ADRs",
       x = "Drug Name", 
       y = "Number of Side Effects") +
  theme_minimal() +
  theme(plot.title = element_text(face = "bold"))

```
The above graph mentions the drugs that has the most side effects.
```{r}
# --- Plot 2: Top 20 Most Frequent Side Effects ---
top_20_side_effects <- drug_se %>%
  count(side_effect_name, sort = TRUE) %>%
  slice_head(n = 15)

ggplot(top_20_side_effects, aes(x = reorder(side_effect_name, n), y = n)) +
  geom_col(fill = "#31688EFF") + # Steel blue
  coord_flip() +
  labs(title = "Top 20 Most Frequent Side Effects",
       subtitle = "The most pervasive clinical symptoms across the entire dataset",
       x = "Side Effect", 
       y = "Frequency (Number of Drugs)") +
  theme_minimal() +
  theme(plot.title = element_text(face = "bold"))
```
The above graph depicts the side effect that was most common among the drugs.

```{r}
# 1. Load Fingerprints
drug_cf <- read.csv("Chemical_fingerprint.csv", row.names = 1)

# 2. Prepare Side Effect counts as an annotation dataframe
se_counts <- drug_se %>%
  count(drugbank_name) %>%
  rename("ADR Count" = n) %>%
  as.data.frame()

# Set drug names as row names for the annotation data
rownames(se_counts) <- se_counts$drugbank_name

# 3. Align the datasets
common_drugs <- intersect(rownames(drug_cf), rownames(se_counts))
subset_drugs <- common_drugs[1:35]

# Create the annotation table for the rows
row_ann <- se_counts[subset_drugs, "ADR Count", drop = FALSE]

# Create the data matrix
plot_matrix <- as.matrix(drug_cf[subset_drugs, 1:35])

# 4. Plot
pheatmap(plot_matrix,
         annotation_row = row_ann,
         clustering_distance_rows = "binary",
         cluster_cols = FALSE,
         color = c("white", "black"),
         main = " Drug vs Chemical Structure vs Adverse Drug Reactions",
         annotation_colors = list("ADR Count" = colorRampPalette(c("yellow", "red"))(50)),
         fontsize_row = 6, fontsize_col = 6)
```
```{r, include=FALSE}
drug_burden <- drug_se %>%
  count(drugbank_name, sort = TRUE)

# 2.2 Distribution of side effect counts
ggplot(drug_burden, aes(x = n)) +
  geom_histogram(binwidth = 5, fill = "orange", color = "white") +
  labs(title = "Distribution of Side Effects per Drug", 
       x = "Number of Side Effects", y = "Number of Drugs") +
  theme_minimal()

# 2.3 Top 10 drugs with most side effects
head(drug_burden, 10)
```

[^2]: Murphy et al. 2005 doi: 10.1186/1468-6708-6-11

<!-- This #### below causes the columns to break -->

<!-- You can change where you put these breaks, and the "column_numbers: 4" argument in the YAMLS header to change the layout of the poster, with care! -->

#### 

# Early Results / Descriptive Statistics of Datasets

Usually you want to have a nice table displaying some important results that you have calculated. In `posterdown` this is as easy as using the `kable` table formatting you are probably use to as per typical R Markdown formatting.

You can reference tables like so: Table \@ref(tab:mytable). Some basic summaries of the dataset are below:

```{r mytable, out.width='80%'}
knitr::kable(iris[1:10, 1:4], caption = 'Table caption.',align = 'c',"html") %>%
  kable_styling(font_size = 20)
```

Figure \@ref(fig:standard-plot), and Figure \@ref(fig:morefigs) below show the patterns in our dataset. Make sure that all the details in your plots will be legible when printed (legend text, axis text, and any labels)

```{r standard-plot, out.width='80%', fig.align='center', fig.cap='Great figure!', fig.height=4}
ggplot(mpg, aes(displ, hwy, colour = class)) + 
  geom_point()
```

```{css, echo=FALSE}
div.logo_left{
  width: 20%;
}
div.poster_title{
  width: 80%;
}
div.footnotes {
    font-size: 18pt;
}
.images-row {
  display: flex;
  justify-content: space-around;
  flex-wrap: wrap;
  margin: 0.5em 0;
}

.images-row img {
  max-width: 18%;
  margin: 0.5em;
  border: none;
  box-shadow: none;
}



```

You can even make your plots interactive for the HTML version of the poster. You can use the HTML poster for the presentation session, and the PDF poster will be printed - so be sure the static version looks okay.

```{r images-row, echo=FALSE, results='asis', fig.align='center', out.width='100%'}
cat('<div class="images-row">')
knitr::include_graphics(
  c(
    "Supporting Documents/output.png"
  )
)
cat('</div>')

```

#### 

# Next Project Steps

We plan to conduct further analysis using:

-   Extended Data set [^3]
-   New methods using weighted NMF, SVD and weighted SVD [^4].

[^3]: Massey et al. 2005 doi: 15.36.413

[^4]: https://doi.org/10.3390/rs13020268

We will use the `plasticanalysis` package for this.


# GitHub

The code and datasets for this project can be viewed at our GitHub repository here: <https://github.com/>



# References



